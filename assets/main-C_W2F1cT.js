(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();class d{constructor(){this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(s=>s!==e))}emit(t,e){this.events[t]&&this.events[t].forEach(s=>{try{s(e)}catch(r){console.error(`Error in event handler for ${t}:`,r)}})}}class h{constructor(t,e,s){this.eventBus=t,this.articleManager=e,this.config=s,this.bindEvents()}bindEvents(){this.eventBus.on("articles:loaded",t=>{this.onArticlesLoaded(t)}),this.eventBus.on("articles:error",t=>{this.onArticlesError(t)})}onArticlesLoaded(t){this.updatePostCount(t.length),this.renderLatestArticles(),this.renderTagsList(),this.articleManager.renderPosts(t)}onArticlesError(t){const e=document.getElementById(this.config.selectors.postsList);e&&(e.innerHTML='<p class="error">加载文章列表失败，请刷新页面重试。</p>')}updatePostCount(t){const e=document.getElementById(this.config.selectors.postCount);e&&(e.textContent=t)}renderLatestArticles(){const t=this.articleManager.getLatestArticles(),e=document.getElementById(this.config.selectors.recentList),s=document.getElementById(this.config.selectors.lastUpdated);s&&t.length>0&&(s.textContent=t[0].lastmod),e&&(e.innerHTML=t.map(r=>`
                <a href="./posts/${r.slug}.html" class="recent-item">${r.title}</a>
            `).join(""))}renderTagsList(){const t=document.getElementById(this.config.selectors.tagsList);if(!t)return;const e=this.articleManager.getAllTags();if(e.length===0){t.innerHTML='<p class="no-tags">暂无标签</p>';return}t.innerHTML=e.map(s=>`<button type="button" data-tag="${s}" class="tag">#${s}</button>`).join("")}initSearch(){const t=document.getElementById(this.config.selectors.searchInput),e=document.getElementById(this.config.selectors.searchBtn);if(e&&t){const s=()=>{const r=this.articleManager.searchArticles(t.value);this.displaySearchResults(r)};e.addEventListener("click",s),t.addEventListener("keypress",r=>{r.key==="Enter"&&s()})}}displaySearchResults(t){this.articleManager.renderPosts(t);const e=document.getElementById(this.config.selectors.searchResults);e&&(e.innerHTML=`找到 ${t.length} 篇相关文章`)}initTagHandlers(){const t=document.getElementById(this.config.selectors.tagsList),e=document.getElementById(this.config.selectors.totalPost);e&&e.addEventListener("click",()=>{this.articleManager.renderPosts(this.articleManager.getAllArticles())}),t&&t.addEventListener("click",s=>{const r=s.target;if(r.classList.contains("tag")){const i=r.dataset.tag,o=this.articleManager.getArticlesByTag(i);this.articleManager.renderPosts(o)}})}}class g{constructor(t){this.config=t,this.themeToggle=document.getElementById(t.selectors.themeToggle),this.currentTheme=this.getStoredTheme()||this.getSystemTheme(),this.init()}init(){this.setTheme(this.currentTheme),this.bindEvents()}getStoredTheme(){return localStorage.getItem("theme")}getSystemTheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}setTheme(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),this.currentTheme=t;const e=document.querySelector(".fas.fa-sun"),s=document.querySelector(".fas.fa-moon");e&&s&&(t==="light"?(e.style.display="block",s.style.display="none"):(e.style.display="none",s.style.display="block"))}toggleTheme(){const t=this.currentTheme==="light"?"dark":"light";this.setTheme(t)}bindEvents(){this.themeToggle&&(this.themeToggle.addEventListener("click",()=>{this.toggleTheme()}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.getStoredTheme()||this.setTheme(t.matches?"dark":"light")}))}}let c=class{static sortArticlesByDate(t){return t.sort((e,s)=>new Date(s.date)-new Date(e.date))}static formatDate(t){if(!t)return"未知日期";const e=new Date(t);return isNaN(e.getTime())?"无效日期":e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}static extractPlainText(t){return t.replace(/^## .*\n/,"").replace(/```[\s\S]*?```/g,"").replace(/`[^`]*`/g,"").replace(/#{1,6}\s?/g,"").replace(/\*\*/g,"").replace(/\*/g,"").trim()}};class u{constructor(t){this.config=t}renderPosts(t,e=this.config.selectors.postsList){const s=document.getElementById(e);if(!s){console.warn(`Container #${e} not found`);return}if(!t||t.length===0){s.innerHTML='<p class="no-posts">暂无文章</p>';return}const r=c.sortArticlesByDate(t),i=this.generatePostsHTML(r);s.innerHTML=i}generatePostsHTML(t){return t.map(e=>this.generateArticleHTML(e)).join("")}generateArticleHTML(t){return`
            <article class="article-card" role="listitem">
                ${t.cover?this.generateCoverHTML(t):""}
                <div class="article-content">
                    <div class="article-title-wrapper">
                        <h2 class="article-title">
                            <a href="./posts/${t.slug}.html">${t.title}</a>
                        </h2>
                        <span class="read-time">${t.readTime||"阅读时间未知"}</span>
                    </div>
                    <p class="article-description">${this.getArticleDescription(t)}</p>
                    <div class="article-meta">
                        <span class="publish-date">发表于 ${c.formatDate(t.date)}</span>
                        ${t.lastmod?`<span class="update-date">更新于 ${c.formatDate(t.lastmod)}</span>`:""}
                    </div>
                    ${t.tags&&t.tags.length>0?this.generateTagsHTML(t.tags):""}
                </div>
            </article>
        `}generateCoverHTML(t){let e=t.cover;return e&&!e.startsWith("/")&&!e.startsWith("http")&&(e=`./images/${e}`),`
    <div class="article-cover">
        <img src="${e||"./images/default-cover.png"}" alt="${t.title}" loading="lazy">
    </div>
    `}generateTagsHTML(t){return`
        <div class="tags">
            ${t.map(e=>`<span class="tag" data-tag="${e}">${e}</span>`).join("")}
        </div>
    `}getArticleDescription(t){if(t.description)return t.description;if(t.excerpt){const e=c.extractPlainText(t.excerpt),s=this.config.defaults.descriptionLength;return e.length>s?e.substring(0,s)+"...":e}return"暂无描述"}}class a{static sortArticlesByDate(t){return[...t].sort((e,s)=>new Date(s.date)-new Date(e.date))}static getLatestArticles(t,e=5){return this.sortArticlesByDate(t).slice(0,e)}static getArticleBySlug(t,e){return t.find(s=>s.slug===e)||null}static getArticlesByTag(t,e){return t.filter(s=>s.tags&&s.tags.includes(e))}static getArticlesByCategory(t,e){return t.filter(s=>s.category===e)}static searchArticles(t,e){const s=e.toLowerCase();return t.filter(r=>r.title.toLowerCase().includes(s)||r.description&&r.description.toLowerCase().includes(s)||r.excerpt&&r.excerpt.toLowerCase().includes(s)||r.tags&&r.tags.some(i=>i.toLowerCase().includes(s)))}static getAllCategories(t){const e=t.map(s=>s.category).filter(Boolean);return[...new Set(e)]}static getAllTags(t){const e=t.filter(s=>s.tags).flatMap(s=>s.tags);return[...new Set(e)]}static formatDate(t){if(!t)return"未知日期";const e=new Date(t);return isNaN(e.getTime())?"无效日期":e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}static estimateReadTime(t){const s=t.split(/\s+/).length,r=Math.ceil(s/200);return r>0?`${r}分钟`:"少于1分钟"}static extractExcerpt(t,e={}){if(e.excerpt)return e.excerpt;if(e.description)return e.description;const s=t.replace(/^#+\s+.+$/gm,"").replace(/```[\s\S]*?```/g,"").replace(/`[^`]*`/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/\n+/g," ").trim();return s.slice(0,200)+(s.length>200?"...":"")}static extractPlainText(t){return t.replace(/^## .*\n/,"").replace(/```[\s\S]*?```/g,"").replace(/`[^`]*`/g,"").replace(/#{1,6}\s?/g,"").replace(/\*\*/g,"").replace(/\*/g,"").trim()}}class p{constructor(t,e){this.articles=[],this.isLoaded=!1,this.loadPromise=null,this.eventBus=t,this.config=e,this.renderer=new u(e)}async loadPosts(){return this.loadPromise?this.loadPromise:(this.loadPromise=this.fetchArticles(),this.loadPromise)}async fetchArticles(){try{const t=await fetch(this.config.endpoints.articlesMetadata);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return this.articles=e.posts||[],this.isLoaded=!0,this.eventBus.emit("articles:loaded",this.articles),this.articles}catch(t){throw console.error("加载文章数据失败:",t),this.eventBus.emit("articles:error",t),t}}renderPosts(t=this.articles){this.renderer.renderPosts(t)}getAllArticles(){return this.ensureLoaded(),[...this.articles]}getArticleBySlug(t){return this.ensureLoaded(),a.getArticleBySlug(this.articles,t)}getArticlesByCategory(t){return this.ensureLoaded(),a.getArticlesByCategory(this.articles,t)}getArticlesByTag(t){return this.ensureLoaded(),a.getArticlesByTag(this.articles,t)}searchArticles(t){return this.ensureLoaded(),a.searchArticles(this.articles,t)}getAllCategories(){return this.ensureLoaded(),a.getAllCategories(this.articles)}getAllTags(){return this.ensureLoaded(),a.getAllTags(this.articles)}getLatestArticles(t=this.config.defaults.latestArticlesCount){return this.ensureLoaded(),a.getLatestArticles(this.articles,t)}getFeaturedArticles(){return this.ensureLoaded(),this.articles.filter(t=>t.featured)}ensureLoaded(){if(!this.isLoaded)throw new Error("文章数据未加载，请先调用 loadPosts() 方法")}async reload(){return this.loadPromise=null,this.isLoaded=!1,this.loadPosts()}getLoadStatus(){return{isLoaded:this.isLoaded,articleCount:this.articles.length}}updatePostCount(){const t=document.getElementById(this.config.selectors.postCount);t&&(t.textContent=this.articles.length)}}const l={selectors:{postsList:"postsList",searchInput:"searchInput",searchBtn:"searchBtn",searchResults:"searchResults",tagsList:"tagsList",recentList:"recentList",postCount:"postCount",totalPost:"totalPost",lastUpdated:"lastUpdated",themeToggle:"themeToggle"},endpoints:{articlesMetadata:"./articles-metadata.json"},defaults:{latestArticlesCount:5,descriptionLength:100}};class m{constructor(){this.eventBus=new d,this.articleManager=new p(this.eventBus,l),this.uiManager=new h(this.eventBus,this.articleManager,l),this.themeToggle=new g(l)}async initialize(){try{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.start()}):await this.start()}catch(t){console.error("应用初始化失败:",t)}}async start(){try{await this.articleManager.loadPosts(),this.uiManager.initSearch(),this.uiManager.initTagHandlers(),document.getElementById("postsList").addEventListener("click",function(t){const e=t.target.closest(".article-card");if(e){const s=e.querySelector(".article-title a");s&&!t.target.closest(".tags")&&(t.preventDefault(),window.location.href=s.href)}}),console.log(" %c 应用初始化完成","background:#35495e ; padding: 2px; border-radius: 3px; color: #fff")}catch(t){console.error("应用启动失败:",t)}}}const f=new m;f.initialize();

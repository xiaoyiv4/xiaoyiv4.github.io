<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <title>轻量博客 - 极简纯前端博客系统</title>
  <meta name="description" content="极简纯前端轻量博客示例（HTML/CSS/JS），支持搜索、标签、编辑与本地存储" />
  <meta name="keywords" content="博客,前端,HTML,CSS,JavaScript" />
  <link rel="stylesheet" href="styles/global.css" />
</head>

<body>
  <div class="bg"></div>
  <header class="header" role="banner">
    <div class="header-left">
      <h1 class="site-title">
        <a href="index.html" aria-label="返回首页">轻量博客</a>
      </h1>
      <p>极简设置 · 专注写作</p>
    </div>
    <div class="header-actions">
      <form role="search" aria-label="站点搜索" method="get" action="search.html">
        <label for="search" class="visually-hidden">搜索文章</label>
        <input id="search" type="search" name="query" placeholder="搜索文章或内容..." aria-label="搜索文章" autocomplete="off" />
      </form>
    </div>
  </header>

  <main id="main-content" class="container layout" role="main">
    <aside class="sidebar" aria-label="侧边栏">
      <section class="widget" aria-labelledby="about-heading">
        <h4 id="about-heading">说明</h4>
        <p class="muted">欢迎大家浏览我的博客。</p>
      </section>

      <section class="widget" aria-labelledby="stats-heading">
        <h4 id="stats-heading">统计</h4>
        <div class="stats-list">
          <p>文章数：<span id="postCount">3</span></p>
          <p>最近更新：<span id="lastUpdated">2023年10月3日</span></p>
        </div>
      </section>

      <section class="widget" aria-labelledby="tags-heading">
        <h4 id="tags-heading">标签</h4>
        <nav id="tagsList" class="tags" aria-label="文章标签">
          <a href="tag-前端.html?tag=前端" class="tag-link">#前端</a>
          <a href="tag-javascript.html?tag=JavaScript" class="tag-link">#JavaScript</a>
          <a href="tag-react.html?tag=React" class="tag-link">#React</a>
          <a href="tag-编程.html?tag=编程" class="tag-link">#编程</a>
          <a href="tag-基础.html?tag=基础" class="tag-link">#基础</a>
        </nav>
      </section>

      <section class="widget" aria-labelledby="recent-heading">
        <h4 id="recent-heading">近期文章</h4>
        <nav id="recentList" class="recent" aria-label="近期文章">
          <a href="post.html?id=1" class="recent item">现代前端开发技术趋势</a>
          <a href="post2.html?id=2" class="recent item">JavaScript 编程基础</a>
          <a href="post3.html?id=3" class="recent item">深入理解CSS Grid</a>
          <a href="post4.html?id=4" class="recent item">编程的含义</a>
        </nav>
      </section>
    </aside>

    <article class="main-col">
      <section id="featured" class="featured" aria-hidden="true" hidden></section>

      <section aria-labelledby="posts-heading">
        <h2 id="posts-heading">文章列表</h2>
        <div id="postsList" class="posts-list" role="list">
          <div class="card">
            <span><a href="post.html?id=1">现代前端开发技术趋势</a></span>
            <p>探讨2023年最值得关注的前端开发技术和工具</p>
            <div class="meta"><span>发表于 2023年10月1日</span><span>最后更新 2023年10月1日</span></div>
          </div>
          <div class="card">
            <span><a href="post2.html?id=2">JavaScript 编程基础</a></span>
            <p>JavaScript 编程基础教程</p>
            <div class="meta"><span>发表于 2023年10月2日</span><span>最后更新 2023年10月2日</span></div>
          </div>
          <div class="card">
            <span><a href="post3.html?id=3">深入理解CSS Grid</a></span>
            <p>CSS Grid 布局详解</p>
            <div class="meta"><span>发表于 2023年10月3日</span><span>最后更新 2023年10月3日</span></div>
          </div>
          <div class="card">
            <span><a href="post4.html?id=4">编程的含义</a></span>
            <p>编程的意义与思考</p>
            <div class="meta"><span>发表于 2023年10月4日</span><span>最后更新 2023年10月4日</span></div>
          </div>
        </div>
        <nav id="pagination" class="pagination" aria-label="分页导航"></nav>
        <p id="emptyHint" class="hint" role="status" hidden>
          暂无文章，点击"新建文章"开始写作。
        </p>
      </section>
    </article>
  </main>

  <footer class="footer" role="contentinfo">© 2025 轻量博客 · <a href="privacy.html" aria-label="隐私政策">隐私政策</a></footer>

  <!-- 异步加载JS -->
  <script src="public/scripts/read.js" defer></script>
  <script>
    let history = window.history;
    const postContainer = document.getElementById("postsList");
    const mainContent = document.querySelector(".main-col");

    postContainer.addEventListener("click", (e) => {
      e.preventDefault();
      const card = e.target.closest(".card");
      if (!card) return;

      const link = card.querySelector("a");
      const postUrl = new URL(link.getAttribute("href"), window.location.origin).href;
      loadPost(postUrl);
    });

    async function loadPost(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

        const result = await res.text();
        const urlObj = new URL(url);
        const id = urlObj.searchParams.get("id");
        const parser = new DOMParser();
        const doc = parser.parseFromString(result, 'text/html');
        // 更新内容
        mainContent.innerHTML = result;
        document.title = doc.querySelector('title').innerText;

        // 更新历史记录
        history.pushState({ postId: id, type: 'post' }, '', url);
      } catch (error) {
        console.error('加载文章失败:', error);
        mainContent.innerHTML = `<p>加载失败: ${error.message}</p>`;
      }
    }

    // 处理浏览器前进/后退
    window.addEventListener('popstate', function (event) {
      if (event.state && event.state.postId) {
        // 重新加载对应文章
        const url = new URL(window.location.href);
        loadPost(url.href);
      } else {
        // 返回列表页时的处理
        location.reload(); // 或者加载列表内容
      }
    });

    // 初始加载时设置初始状态
    history.replaceState({ type: 'list' }, '', window.location.href);
  </script>
</body>

</html>